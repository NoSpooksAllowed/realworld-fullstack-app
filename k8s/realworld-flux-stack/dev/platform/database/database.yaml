apiVersion: postgresql.cnpg.io/v1
kind: Cluster
metadata:
  name: postgres
  namespace: realworld-app
spec:
  imageName: ghcr.io/cloudnative-pg/postgresql:18.1-system-trixie@sha256:1fdc62057f9ce3b635fbbf42f35ff0edc8781621ebc82edb7d75508991bb9b06

  monitoring:
    enablePodMonitor: false

  instances: 1
  storage:
    size: 2Gi
  bootstrap:
    initdb:
      database: db
      owner: myuser
      secret:
        name: postgres-secret

  backup:
    barmanObjectStore:
      destinationPath: gs://cnpg-backups-realworld-app-483521/
      googleCredentials:
        applicationCredentials:
          name: gcp-storage-secret
          key: credentials.json

      wal:
        compression: gzip
        maxParallel: 8

      data:
        compression: gzip
        jobs: 4

    retentionPolicy: "30d"
